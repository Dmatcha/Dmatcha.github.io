<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Host Tracker</title>
<style>
  :root{
    --bg:#121212;
    --card:#1f1f1f;
    --muted:#9aa3ad;
    --accent-purple: rgba(106,27,154,0.22);
    --gold: #D4AF37;
    --blue-cool:#66ccff;
    --glass: rgba(255,255,255,0.04);
  }

  body {
    font-family: "Inter", "Segoe UI", Arial, sans-serif;
    background: linear-gradient(180deg, #0f0f12 0%, #141417 60%);
    color: #e9eef6;
    margin: 0;
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    gap: 0.5rem;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Mobile-first responsive adjustments */
  @media (min-width: 768px) {
    body {
      padding: 1rem;
      gap: 1rem;
    }
  }

  /* Header */
  .header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: 20px;
    padding: 0.8rem 1.2rem;
    margin-bottom: 0.5rem;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    gap: 0.5rem;
    transition: transform .14s ease, box-shadow .14s ease;
  }

  .header:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 30px rgba(0,0,0,0.7);
  }

  .header > div:first-child {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
    min-width: 140px;
  }

  .header select, .header div {
    font-size: 0.9rem;
    color: #e9eef6;
    background: rgba(255,255,255,0.06);
    border: 0;
    padding: 0.3rem 0.5rem;
    border-radius: 8px;
    flex-shrink: 0;
    transition: all 0.2s ease;
  }

  .header select:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(102,204,255,0.12);
  }

  @media (max-width: 600px) {
    .header {
      padding: 0.6rem;
    }
    
    .header select {
      font-size: 0.8rem;
      padding: 0.25rem 0.4rem;
    }
  }

  #actCounter {
    cursor: pointer;
    font-weight: bold;
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    background: rgba(255,255,255,0.06);
    transition: 0.2s;
    width: auto;
    min-width: 60px;
    text-align: center;
    border: 0;
    color: #fff;
    font-family: inherit;
  }

  @media (max-width: 400px) {
    #actCounter {
      font-size: 0.9rem;
      padding: 0.25rem 0.5rem;
      min-width: 50px;
    }
  }

  #actCounter:hover { 
    background: rgba(255,255,255,0.12);
    transform: scale(1.05);
  }

  /* Player Section */
  .player-section {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: 20px;
    padding: 0.8rem;
    margin-bottom: 0.8rem;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    transition: transform .14s ease, box-shadow .14s ease;
  }

  @media (min-width: 768px) {
    .player-section {
      padding: 1rem;
      margin-bottom: 1rem;
    }
  }

  .player-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 30px rgba(0,0,0,0.7);
  }

  /* Improved responsive player row layout */
  .player-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.8rem;
  }

  @media (min-width: 768px) {
    .player-row {
      grid-template-columns: 120px 1fr 1fr;
      gap: 1rem;
      align-items: start;
    }
  }

  @media (min-width: 1200px) {
    .player-row {
      grid-template-columns: 150px 1fr 1.2fr;
    }
  }

  .player-row input[type=text] {
    font-size: 1rem;
    background: transparent;
    border: none;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    color: white;
    padding: 0.2rem;
    width: 100%;
    font-family: inherit;
  }

  .player-row input[type=text]::placeholder {
    color: rgba(255,255,255,0.25);
  }

  @media (max-width: 600px) {
    .player-row input[type=text] {
      font-size: 0.9rem;
      padding: 0.15rem;
    }
  }

  /* Combined Madness and Life tracker */
  .madness-life-container {
    display: flex;
    gap: 0.8rem;
    align-items: center;
    background: rgba(255,255,255,0.06);
    padding: 0.6rem;
    border-radius: 12px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
    flex-wrap: wrap;
  }

  @media (max-width: 600px) {
    .madness-life-container {
      padding: 0.5rem;
      gap: 0.5rem;
    }
  }

  .madness-life-container .bar {
    background: none;
    padding: 0;
    box-shadow: none;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    flex: 1;
    min-width: 120px;
  }

  @media (max-width: 400px) {
    .madness-life-container .bar {
      min-width: 100px;
    }
  }

  /* Player Stats container */
  .player-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.4rem;
    background: rgba(255,255,255,0.06);
    padding: 0.6rem;
    border-radius: 12px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
  }

  @media (max-width: 600px) {
    .player-stats {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.3rem;
      padding: 0.5rem;
    }
  }

  @media (max-width: 400px) {
    .player-stats {
      grid-template-columns: 1fr;
      gap: 0.3rem;
    }
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    min-width: 0;
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    padding: 0.8rem 0.5rem;
    transition: transform .16s ease, box-shadow .16s ease;
  }

  .stat-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 8px rgba(138, 43, 226, 0.2);
  }

  .stat-label {
    font-size: 0.75rem;
    color: #9aa3ad;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 600;
  }

  @media (max-width: 600px) {
    .stat-label {
      font-size: 0.7rem;
    }
  }

  .stat-controls {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    justify-content: center;
  }

  .stat-controls button {
    -webkit-appearance: none;
    appearance: none;
    border: 0;
    background: rgba(255,255,255,0.06);
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
    font-weight: 700;
    font-family: inherit;
    font-size: 0.9rem;
    min-width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    box-sizing: border-box;
    padding: 0;
    text-align: center;
    vertical-align: middle;
  }

  .stat-controls button:hover {
    background: rgba(255,255,255,0.1);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  .stat-controls button:active {
    transform: translateY(0);
    background: rgba(255,255,255,0.08);
  }



  .stat-value {
    min-width: 24px;
    text-align: center;
    font-weight: 700;
    font-size: 0.9rem;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @media (max-width: 600px) {
    .stat-value {
      font-size: 0.8rem;
      min-width: 20px;
    }
  }

  /* Color coding for stat values */
  .stat-soul .stat-value { color: #9c27b0; }
  .stat-level .stat-value { color: #ff9800; }
  .stat-life .stat-value { color: #5fd08f; }
  .stat-stamina .stat-value { color: #6fb8ff; }
  .stat-mana .stat-value { color: #ffc46b; }
  .stat-energy .stat-value { color: #6ff0ff; }

  /* Bars */
  .bar {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: rgba(255,255,255,0.06);
    padding: 0.4rem 0.6rem;
    border-radius: 10px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
  }

  .bar button {
    -webkit-appearance: none;
    appearance: none;
    border: 0;
    background: rgba(255,255,255,0.06);
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
    font-weight: 700;
    font-family: inherit;
    font-size: 0.9rem;
    min-width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    box-sizing: border-box;
    padding: 0;
    text-align: center;
    vertical-align: middle;
  }

  .bar button:hover {
    background: rgba(255,255,255,0.1);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  .bar button:active {
    transform: translateY(0);
    background: rgba(255,255,255,0.08);
  }



  .bar span.value {
    min-width: 32px;
    text-align: center;
    font-weight: bold;
    color: #ffffff;
  }

  @media (max-width: 600px) {
    .bar span.value {
      min-width: 24px;
      font-size: 0.9rem;
    }
  }

  .madness span.value { color: #e57373; }
  .life span.value { color: #5fd08f; }

  /* Enhanced checkbox styling */
  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.8rem;
    justify-items: center;
    align-items: center;
    padding: 0.5rem;
    margin-top: 0.5rem;
  }

  @media (min-width: 768px) {
    .checkbox-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 0.8rem;
    }
  }

  @media (max-width: 400px) {
    .checkbox-grid {
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem;
    }
  }

  .checkbox-grid label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    cursor: pointer;
    background: rgba(255,255,255,0.04);
    padding: 0.6rem 1rem;
    border-radius: 10px;
    border: 2px solid transparent;
    transition: all .2s ease;
    font-weight: 500;
    white-space: nowrap;
    color: #e9eef6;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    /* Fixed width for consistent sizing */
    width: 100px;
    min-width: 100px;
    max-width: 120px;
    text-align: center;
  }

  .checkbox-grid label:hover {
    background: rgba(255,255,255,0.08);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
  }

  .checkbox-grid input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid transparent;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    transition: all .2s ease;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
  }

  /* Color coding for different checkbox types */
  .checkbox-grid label:has(input[name*="Favour"]) input[type="checkbox"],
  .checkbox-grid label:has(input[name*="Blessed"]) input[type="checkbox"] {
    background: linear-gradient(135deg, #ff6b9d, #ff4081);
  }

  .checkbox-grid label:has(input[name*="Dread"]) input[type="checkbox"],
  .checkbox-grid label:has(input[name*="Cursed"]) input[type="checkbox"] {
    background: linear-gradient(135deg, #9c27b0, #673ab7);
  }

  /* Checked state with border and checkmark */
  .checkbox-grid input[type="checkbox"]:checked {
    background: currentColor;
  }

  .checkbox-grid input[type="checkbox"]:checked::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 12px;
  }

  /* Border only shows when checked - handled via JavaScript class toggling */
  .checkbox-grid label.border-pink.checked {
    border-color: #ff6b9d;
    box-shadow: 0 0 0 2px rgba(255,107,157,0.3), 0 2px 8px rgba(0,0,0,0.2);
  }

  .checkbox-grid label.border-purple.checked {
    border-color: #9c27b0;
    box-shadow: 0 0 0 2px rgba(156,39,176,0.3), 0 2px 8px rgba(0,0,0,0.2);
  }

  /* Focus states for accessibility */
  .checkbox-grid input[type="checkbox"]:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255,255,255,0.2);
  }

  .checkbox-grid label.border-pink:focus-within {
    border-color: #ff6b9d;
    box-shadow: 0 0 0 3px rgba(255,107,157,0.2);
  }

  .checkbox-grid label.border-purple:focus-within {
    border-color: #9c27b0;
    box-shadow: 0 0 0 3px rgba(156,39,176,0.2);
  }

  /* Active states */
  .checkbox-grid label.border-pink:active {
    background: rgba(255,107,157,0.2);
  }

  .checkbox-grid label.border-purple:active {
    background: rgba(156,39,176,0.2);
  }

  /* Mobile responsive adjustments */
  @media (max-width: 600px) {
    .checkbox-grid label {
      font-size: 0.8rem;
      gap: 0.3rem;
      width: 90px;
      min-width: 90px;
      max-width: 100px;
      padding: 0.5rem 0.8rem;
    }
    
    .checkbox-grid input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }
  }

  @media (max-width: 400px) {
    .checkbox-grid label {
      font-size: 0.75rem;
      width: 80px;
      min-width: 80px;
      max-width: 90px;
      padding: 0.4rem 0.6rem;
    }
  }

  /* Footer */
  .footer {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-top: 0.5rem;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: 20px;
    padding: 0.8rem;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    flex-wrap: wrap;
    gap: 0.5rem;
    transition: transform .14s ease, box-shadow .14s ease;
  }

  .footer:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 30px rgba(0,0,0,0.7);
  }

  @media (max-width: 600px) {
    .footer {
      padding: 0.6rem;
      flex-direction: column;
    }
  }

  .dice-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    justify-content: center;
  }

  @media (max-width: 600px) {
    .dice-buttons {
      gap: 0.3rem;
    }
  }

  .dice-buttons button,
  .big-button,
  #coinTossBtn,
  #enemyBtn {
    -webkit-appearance: none;
    appearance: none;
    border: 0;
    background: rgba(255,255,255,0.06);
    color: #fff;
    cursor: pointer;
    border-radius: 12px;
    transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
    font-weight: 700;
    font-family: inherit;
    flex: 0 0 auto;
    padding: 0.6rem 1rem;
    font-size: 1rem;
    box-shadow: inset 0 1px 3px rgba(255,255,255,0.06);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @media (max-width: 600px) {
    .dice-buttons button,
    .big-button,
    #coinTossBtn,
    #enemyBtn {
      padding: 0.5rem 0.8rem;
      font-size: 0.9rem;
      margin: 0.1rem;
    }
  }

  @media (max-width: 400px) {
    .dice-buttons button,
    .big-button,
    #coinTossBtn,
    #enemyBtn {
      padding: 0.4rem 0.6rem;
      font-size: 0.8rem;
    }
  }

  .dice-buttons button:hover,
  .big-button:hover,
  #coinTossBtn:hover,
  #enemyBtn:hover {
    background: rgba(255,255,255,0.12);
    transform: scale(1.05);
  }

  .dice-buttons button:active,
  .big-button:active,
  #coinTossBtn:active,
  #enemyBtn:active {
    transform: scale(0.97);
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.3);
  }

  /* Animation class */
  .animate {
    animation: bounceScale 1.2s ease forwards;
  }

  @keyframes bounceScale {
    0% { transform: scale(1); }
    20% { transform: scale(1.3); }
    40% { transform: scale(0.9); }
    60% { transform: scale(1.15); }
    80% { transform: scale(0.95); }
    100% { transform: scale(1); }
  }

  /* Enemy Tracker */
  #enemyTracker {
    display: none;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }

  #enemyTracker.open {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }

  #enemiesContainer {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  @media (max-width: 600px) {
    #enemiesContainer {
      grid-template-columns: 1fr;
      gap: 0.8rem;
    }
  }

  .enemy-row {
    background: linear-gradient(160deg,#3a2a44,#2a1f33);
    border-radius: 20px;
    padding: 1rem;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    transition: transform .14s ease, box-shadow .14s ease;
  }

  .enemy-row:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 30px rgba(0,0,0,0.7);
  }

  .enemy-row input {
    font-size: 1rem;
    border: none;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    background: transparent;
    color: #fff;
    padding: 0.25rem;
    font-family: inherit;
  }

  .enemy-row input::placeholder {
    color: rgba(255,255,255,0.25);
  }

  @media (max-width: 600px) {
    .enemy-row input {
      font-size: 0.9rem;
    }
  }

  .enemy-row button {
    background: rgba(255,255,255,0.06);
    border: 0;
    padding: 0.3rem 0.7rem;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    transition: 0.2s;
    font-weight: 700;
    font-family: inherit;
  }

  .enemy-row button:hover { 
    background: rgba(255,255,255,0.12);
    transform: scale(1.05);
  }

  #enemyBtn.enemy-closed {
    background: linear-gradient(145deg, #b71c1c, #7f0000);
  }

  #enemyBtn.enemy-open {
    background: linear-gradient(145deg, #1565c0, #0d47a1);
  }

  /* Reset button specific styling */
  #resetBtn {
    -webkit-appearance: none;
    appearance: none;
    border: 0;
    background: rgba(255,255,255,0.06);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
    font-size: 0.9rem;
    font-weight: 700;
    font-family: inherit;
    padding: 0.4rem 0.8rem;
  }

  @media (max-width: 600px) {
    #resetBtn {
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
    }
  }

  #resetBtn:hover {
    background: rgba(255,255,255,0.12);
    transform: scale(1.05);
  }

  /* Add Player button */
  #playersContainer button:not(.diceBtn):not(.big-button):not(#coinTossBtn):not(#enemyBtn):not(#addEnemyBtn) {
    -webkit-appearance: none;
    appearance: none;
    border: 0;
    background: rgba(255,255,255,0.06);
    border-radius: 12px;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1rem;
    font-weight: 700;
    font-family: inherit;
    display: block;
    margin: 0.5rem auto;
    padding: 0.8rem 1.5rem;
    box-shadow: inset 0 1px 3px rgba(255,255,255,0.06);
  }

  #playersContainer button:not(.diceBtn):not(.big-button):not(#coinTossBtn):not(#enemyBtn):not(#addEnemyBtn):hover {
    background: rgba(255,255,255,0.12);
    transform: scale(1.05);
  }

  /* Player stat labels styling */
  .stat-name {
    font-weight: 700;
    color: #e9eef6;
    font-size: 0.9rem;
  }

  @media (max-width: 600px) {
    .stat-name {
      font-size: 0.8rem;
    }
  }

  /* Pulse animation for interactive elements */
  @keyframes clickPulse {
    0%{ transform: scale(1); box-shadow: 0 0 0 rgba(106,27,154,0.0); }
    40%{ transform: scale(1.06); box-shadow: 0 8px 24px rgba(106,27,154,0.22); }
    100%{ transform: scale(1); box-shadow: 0 0 0 rgba(106,27,154,0.0); }
  }
  .pulse { animation: clickPulse .5s ease forwards; }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div>
    <span class="stat-name">HOST</span>
    <button id="resetBtn">Reset</button>
  </div>
  <select id="villainSelect">
    <option>Angelo Adair</option>
    <option>Byron vey Byornn</option>
    <option>Ceng Zhangyi</option>
    <option>Daisuke Daioh</option>
    <option>Elizabeth Einsborough</option>
    <option>Fal</option>
    <option>Gary Gigantes</option>
    <option>Hyunjin Halvela</option>
    <option>Isaac Ivanson</option>
    <option>JJ The Beast</option>
    <option>Kleo</option>
    <option>Li</option>
    <option>Maelle</option>
    <option>Neville Schwarz</option>
    <option>Olum Farhoud</option>
    <option>Paarth Lomedi</option>
    <option>Qing</option>
    <option>Reeve Basilisk</option>
    <option>Vincent</option>
    <option>Taeonora</option>
  </select>
  <div id="actCounter">Act 0</div>
</div>

<!-- PLAYERS -->
<div id="playersContainer"></div>

<!-- FOOTER -->
<div class="footer">
  <div style="flex-grow:1; text-align:center;">
    <div id="rollResult" style="font-size:1.2rem; min-height:1.5rem; margin-bottom:0.5rem;"></div>
    <div class="dice-buttons">
      <button class="big-button diceBtn" data-dice="1d6">1d6</button>
      <button class="big-button diceBtn" data-dice="2d6">2d6</button>
      <button class="big-button diceBtn" data-dice="1d8">1d8</button>
      <button class="big-button diceBtn" data-dice="1d10">1d10</button>
      <button class="big-button diceBtn" data-dice="1d12">1d12</button>
      <button class="big-button diceBtn" data-dice="1d20">1d20</button>
      <button id="coinTossBtn">Coin Toss</button>
      <button id="enemyBtn">Enemy</button>
    </div>
  </div>
</div>

<!-- ENEMIES -->
<div id="enemyTracker">
  <h3 style="display:flex; align-items:center; justify-content:space-between;">
    Enemy Encounter 
    <button id="addEnemyBtn">Add Enemy</button>
  </h3>
  <div id="enemiesContainer"></div>
</div>

<script>
// Helpers
function saveState(k,v){ localStorage.setItem(k,JSON.stringify(v)); }
function loadState(k,f){ const v=localStorage.getItem(k); return v?JSON.parse(v):f; }

// Act Counter
const acts=["Act 0","Act I","Act II","Act III","Finale"];
let currentAct=loadState("currentAct",0);
document.getElementById("actCounter").textContent=acts[currentAct];
document.getElementById("actCounter").onclick=()=>{
  currentAct=(currentAct+1)%acts.length;
  document.getElementById("actCounter").textContent=acts[currentAct];
  saveState("currentAct",currentAct);
};
const actBtn = document.getElementById("actCounter");
let actCooldown = false;

actBtn.onclick = () => {
  if (actCooldown) return;        // ignore clicks during cooldown
  actCooldown = true;             // start cooldown

  currentAct = (currentAct + 1) % acts.length;
  actBtn.textContent = acts[currentAct];
  saveState("currentAct", currentAct);

  setTimeout(() => actCooldown = false, 2000); // 2-second cooldown
};

// Villain
const villainSelect=document.getElementById("villainSelect");
villainSelect.value=loadState("currentVillain",villainSelect.value);
villainSelect.onchange=()=>saveState("currentVillain",villainSelect.value);

// Players
const playersContainer=document.getElementById("playersContainer");
let players=loadState("hostPlayers",["P1","P2","P3"]);

function renderPlayers(){
  playersContainer.innerHTML="";
  players.forEach((name,idx)=>{
    const card=document.createElement("div");
    card.className="player-section";

    const row=document.createElement("div");
    row.className="player-row";

    // Player Name
    const nameInput=document.createElement("input");
    nameInput.type="text";
    nameInput.placeholder=name;
    nameInput.value=loadState("playerName"+idx,"");
    nameInput.onkeydown=(e)=>{ if(e.key==="Enter"){ saveState("playerName"+idx,nameInput.value); nameInput.blur(); }};
    nameInput.onblur=()=>saveState("playerName"+idx,nameInput.value);
    row.appendChild(nameInput);

    // Combined Madness and Life tracker
    const madnessLifeContainer=document.createElement("div");
    madnessLifeContainer.className="madness-life-container";
    
    // Madness
    let mv=loadState("playerMadness"+idx,0);
    const madnessDiv=document.createElement("div");
    madnessDiv.className="bar madness";
    const mMinus=document.createElement("button");
    mMinus.textContent="−";
    const mVal=document.createElement("span");
    mVal.className="value";
    mVal.textContent=mv;
    const mPlus=document.createElement("button");
    mPlus.textContent="+";
    mMinus.onclick=()=>{ if(mv>0){ mv--; mVal.textContent=mv; saveState("playerMadness"+idx,mv);} };
    mPlus.onclick=()=>{ mv++; mVal.textContent=mv; saveState("playerMadness"+idx,mv);} ;
    madnessDiv.append(mMinus, "Madness:", mVal, mPlus);
    madnessLifeContainer.appendChild(madnessDiv);
    
    // Life
    let lv=loadState("playerLife"+idx,0);
    const lifeDiv=document.createElement("div");
    lifeDiv.className="bar life";
    const lMinus=document.createElement("button");
    lMinus.textContent="−";
    const lVal=document.createElement("span");
    lVal.className="value";
    lVal.textContent=lv;
    const lPlus=document.createElement("button");
    lPlus.textContent="+";
    lMinus.onclick=()=>{ lv--; lVal.textContent=lv; saveState("playerLife"+idx,lv);} ;
    lPlus.onclick=()=>{ lv++; lVal.textContent=lv; saveState("playerLife"+idx,lv);} ;
    lifeDiv.append(lMinus, "Life:", lVal, lPlus);
    madnessLifeContainer.appendChild(lifeDiv);
    
    row.appendChild(madnessLifeContainer);

    // New Player Stats
    const statsContainer=document.createElement("div");
    statsContainer.className="player-stats";
    
    // SOUL (0-5)
    const soulDiv=document.createElement("div");
    soulDiv.className="stat-item stat-soul";
    const soulLabel=document.createElement("div");
    soulLabel.className="stat-label";
    soulLabel.textContent="SOUL";
    const soulControls=document.createElement("div");
    soulControls.className="stat-controls";
    let soulVal=loadState("playerSoul"+idx,0);
    const soulMinus=document.createElement("button");
    soulMinus.textContent="−";
    const soulValue=document.createElement("span");
    soulValue.className="stat-value";
    soulValue.textContent=soulVal;
    const soulPlus=document.createElement("button");
    soulPlus.textContent="+";
    soulMinus.onclick=()=>{ if(soulVal>0){ soulVal--; soulValue.textContent=soulVal; saveState("playerSoul"+idx,soulVal);} };
    soulPlus.onclick=()=>{ if(soulVal<5){ soulVal++; soulValue.textContent=soulVal; saveState("playerSoul"+idx,soulVal);} };
    soulControls.append(soulMinus, soulValue, soulPlus);
    soulDiv.append(soulLabel, soulControls);
    statsContainer.appendChild(soulDiv);
    
    // Level (1-20)
    const levelDiv=document.createElement("div");
    levelDiv.className="stat-item stat-level";
    const levelLabel=document.createElement("div");
    levelLabel.className="stat-label";
    levelLabel.textContent="Level";
    const levelControls=document.createElement("div");
    levelControls.className="stat-controls";
    let levelVal=loadState("playerLevel"+idx,1);
    const levelMinus=document.createElement("button");
    levelMinus.textContent="−";
    const levelValue=document.createElement("span");
    levelValue.className="stat-value";
    levelValue.textContent=levelVal;
    const levelPlus=document.createElement("button");
    levelPlus.textContent="+";
    levelMinus.onclick=()=>{ if(levelVal>1){ levelVal--; levelValue.textContent=levelVal; saveState("playerLevel"+idx,levelVal);} };
    levelPlus.onclick=()=>{ if(levelVal<20){ levelVal++; levelValue.textContent=levelVal; saveState("playerLevel"+idx,levelVal);} };
    levelControls.append(levelMinus, levelValue, levelPlus);
    levelDiv.append(levelLabel, levelControls);
    statsContainer.appendChild(levelDiv);
    
    // Max Life (max 20) - Updated label
    const maxLifeDiv=document.createElement("div");
    maxLifeDiv.className="stat-item stat-life";
    const maxLifeLabel=document.createElement("div");
    maxLifeLabel.className="stat-label";
    maxLifeLabel.textContent="Max Life";
    const maxLifeControls=document.createElement("div");
    maxLifeControls.className="stat-controls";
    let maxLifeVal=loadState("playerMaxLife"+idx,3);
    const maxLifeMinus=document.createElement("button");
    maxLifeMinus.textContent="−";
    const maxLifeValue=document.createElement("span");
    maxLifeValue.className="stat-value";
    maxLifeValue.textContent=maxLifeVal;
    const maxLifePlus=document.createElement("button");
    maxLifePlus.textContent="+";
    maxLifeMinus.onclick=()=>{ if(maxLifeVal>1){ maxLifeVal--; maxLifeValue.textContent=maxLifeVal; saveState("playerMaxLife"+idx,maxLifeVal);} };
    maxLifePlus.onclick=()=>{ if(maxLifeVal<20){ maxLifeVal++; maxLifeValue.textContent=maxLifeVal; saveState("playerMaxLife"+idx,maxLifeVal);} };
    maxLifeControls.append(maxLifeMinus, maxLifeValue, maxLifePlus);
    maxLifeDiv.append(maxLifeLabel, maxLifeControls);
    statsContainer.appendChild(maxLifeDiv);
    
    // Max Stamina (max 8) - Updated label
    const staminaDiv=document.createElement("div");
    staminaDiv.className="stat-item stat-stamina";
    const staminaLabel=document.createElement("div");
    staminaLabel.className="stat-label";
    staminaLabel.textContent="Max Stamina";
    const staminaControls=document.createElement("div");
    staminaControls.className="stat-controls";
    let staminaVal=loadState("playerStamina"+idx,2);
    const staminaMinus=document.createElement("button");
    staminaMinus.textContent="−";
    const staminaValue=document.createElement("span");
    staminaValue.className="stat-value";
    staminaValue.textContent=staminaVal;
    const staminaPlus=document.createElement("button");
    staminaPlus.textContent="+";
    staminaMinus.onclick=()=>{ if(staminaVal>0){ staminaVal--; staminaValue.textContent=staminaVal; saveState("playerStamina"+idx,staminaVal);} };
    staminaPlus.onclick=()=>{ if(staminaVal<8){ staminaVal++; staminaValue.textContent=staminaVal; saveState("playerStamina"+idx,staminaVal);} };
    staminaControls.append(staminaMinus, staminaValue, staminaPlus);
    staminaDiv.append(staminaLabel, staminaControls);
    statsContainer.appendChild(staminaDiv);
    
    // Max Mana (max 20) - Updated label
    const manaDiv=document.createElement("div");
    manaDiv.className="stat-item stat-mana";
    const manaLabel=document.createElement("div");
    manaLabel.className="stat-label";
    manaLabel.textContent="Max Mana";
    const manaControls=document.createElement("div");
    manaControls.className="stat-controls";
    let manaVal=loadState("playerMana"+idx,1);
    const manaMinus=document.createElement("button");
    manaMinus.textContent="−";
    const manaValue=document.createElement("span");
    manaValue.className="stat-value";
    manaValue.textContent=manaVal;
    const manaPlus=document.createElement("button");
    manaPlus.textContent="+";
    manaMinus.onclick=()=>{ if(manaVal>0){ manaVal--; manaValue.textContent=manaVal; saveState("playerMana"+idx,manaVal);} };
    manaPlus.onclick=()=>{ if(manaVal<20){ manaVal++; manaValue.textContent=manaVal; saveState("playerMana"+idx,manaVal);} };
    manaControls.append(manaMinus, manaValue, manaPlus);
    manaDiv.append(manaLabel, manaControls);
    statsContainer.appendChild(manaDiv);
    
    // Max Energy (max 20) - Updated label
    const energyDiv=document.createElement("div");
    energyDiv.className="stat-item stat-energy";
    const energyLabel=document.createElement("div");
    energyLabel.className="stat-label";
    energyLabel.textContent="Max Energy";
    const energyControls=document.createElement("div");
    energyControls.className="stat-controls";
    let energyVal=loadState("playerEnergy"+idx,1);
    const energyMinus=document.createElement("button");
    energyMinus.textContent="−";
    const energyValue=document.createElement("span");
    energyValue.className="stat-value";
    energyValue.textContent=energyVal;
    const energyPlus=document.createElement("button");
    energyPlus.textContent="+";
    energyMinus.onclick=()=>{ if(energyVal>0){ energyVal--; energyValue.textContent=energyVal; saveState("playerEnergy"+idx,energyVal);} };
    energyPlus.onclick=()=>{ if(energyVal<20){ energyVal++; energyValue.textContent=energyVal; saveState("playerEnergy"+idx,energyVal);} };
    energyControls.append(energyMinus, energyValue, energyPlus);
    energyDiv.append(energyLabel, energyControls);
    statsContainer.appendChild(energyDiv);
    
    row.appendChild(statsContainer);

    // Checkboxes (2x2 grid)
    const cbDiv = document.createElement("div");
    cbDiv.className = "checkbox-grid";
    ["Favour","Dread","Blessed","Cursed"].forEach(cbName => {
      const label = document.createElement("label");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = loadState(cbName+idx,false);
      cb.onchange = () => saveState(cbName+idx,cb.checked);
      label.append(cb, cbName);
      cbDiv.appendChild(label);
    });
    row.appendChild(cbDiv);

    card.appendChild(row);
    playersContainer.appendChild(card);
  });

  if(players.length<10){
    const addBtn=document.createElement("button");
    addBtn.textContent="Add Player";
    addBtn.onclick=()=>{ 
      players.push("P"+(players.length+1)); 
      saveState("hostPlayers",players); 
      renderPlayers(); 
    };
    playersContainer.appendChild(addBtn);
  }
}

renderPlayers();

// Reset
document.getElementById("resetBtn").onclick = () => {
  if (confirm("Are you sure you want to reset everything? This cannot be undone.")) {
    localStorage.clear();
    location.reload();
  }
};

// Enemies
const enemyTracker = document.getElementById("enemyTracker");
const enemyBtn = document.getElementById("enemyBtn");
enemyBtn.classList.add("enemy-closed"); // default red

enemyBtn.onclick = () => {
  enemyTracker.classList.toggle("open");
  if (enemyTracker.classList.contains("open")) {
    enemyBtn.classList.remove("enemy-closed");
    enemyBtn.classList.add("enemy-open");
  } else {
    enemyBtn.classList.remove("enemy-open");
    enemyBtn.classList.add("enemy-closed");
  }
};

let enemies=loadState("enemies",[]);
function saveEnemies(){ saveState("enemies",enemies); }
function renderEnemies(){
  const cont=document.getElementById("enemiesContainer");
  cont.innerHTML="";
  enemies.forEach((enemy,idx)=>{
    const row=document.createElement("div");
    row.className="enemy-row";

    const input=document.createElement("input");
    input.placeholder=`Enemy ${idx+1}`;
    input.value=enemy.name||"";
    input.onblur=()=>{ enemy.name=input.value; saveEnemies(); };
    input.onkeydown=(e)=>{ if(e.key==="Enter"){ enemy.name=input.value; saveEnemies(); input.blur(); } };
    row.appendChild(input);

    // Power
    const pDiv=document.createElement("div"); pDiv.className="bar";
    const pMinus=document.createElement("button"); pMinus.textContent="−";
    const pVal=document.createElement("span"); pVal.className="value"; pVal.textContent=enemy.power;
    const pPlus=document.createElement("button"); pPlus.textContent="+";
    pMinus.onclick=()=>{ if(enemy.power>0){ enemy.power--; pVal.textContent=enemy.power; saveEnemies(); }};
    pPlus.onclick=()=>{ enemy.power++; pVal.textContent=enemy.power; saveEnemies(); };
    pDiv.append(pMinus,"Power:",pVal,pPlus);
    row.appendChild(pDiv);

    // Life
    const lDiv=document.createElement("div"); lDiv.className="bar";
    const lMinus=document.createElement("button"); lMinus.textContent="−";
    const lVal=document.createElement("span"); lVal.className="value"; lVal.textContent=enemy.life;
    const lPlus=document.createElement("button"); lPlus.textContent="+";
    lMinus.onclick=()=>{ if(enemy.life>0){ enemy.life--; lVal.textContent=enemy.life; saveEnemies(); }};
    lPlus.onclick=()=>{ enemy.life++; lVal.textContent=enemy.life; saveEnemies(); };
    lDiv.append(lMinus,"Life:",lVal,lPlus);
    row.appendChild(lDiv);

    const killBtn=document.createElement("button");
    killBtn.textContent="Kill";
    killBtn.onclick=()=>{ enemies.splice(idx,1); saveEnemies(); renderEnemies(); };
    row.appendChild(killBtn);

    cont.appendChild(row);
  });
}
document.getElementById("addEnemyBtn").onclick=()=>{ if(enemies.length<16){ enemies.push({name:"",power:0,life:0}); saveEnemies(); renderEnemies(); }};
renderEnemies();

// Dice + Coin Toss
let rollCooldown = false;

// Animate button when clicked
function animateButton(button) {
  button.classList.add("animate");
  setTimeout(() => button.classList.remove("animate"), 1500);
}

function setRollResult(text) {
  document.getElementById("rollResult").textContent = text;
  rollCooldown = true;
  setTimeout(() => rollCooldown = false, 2200);
}

document.getElementById("coinTossBtn").onclick = (e) => {
  if (rollCooldown) return;
  animateButton(e.target);
  setRollResult("Coin Toss: " + (Math.random() < 0.5 ? "Heads" : "Tails"));
};

document.querySelectorAll(".diceBtn").forEach(btn => {
  btn.onclick = (e) => {
    if (rollCooldown) return;
    animateButton(e.target);
    const [n, d] = btn.dataset.dice.split("d").map(Number);
    let total = 0;
    for (let i = 0; i < n; i++) {
      total += Math.floor(Math.random() * d) + 1;
    }
    setRollResult(`${btn.dataset.dice} rolled: ${total}`);
  };
});
</script>
</body>
</html>