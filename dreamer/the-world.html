<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The WORLD — Redesigned</title>
  <style>
    /* -------------------------
       Base / Reset
       ------------------------- */
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: "Georgia", serif;
      background: linear-gradient(135deg,#8B4513 0%, #D2691E 30%, #F4A460 60%, #DEB887 100%);
      color:#2F1B14;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-y:auto;
    }
body {
  background: linear-gradient(135deg,#8B4513 0%, #D2691E 30%, #F4A460 60%, #DEB887 100%);
  background-repeat: no-repeat;   /* STOP repeating */
  background-attachment: fixed;   /* Stays in place while scrolling */
  background-size: cover;         /* Fills whole viewport */
}
    /* -------------------------
       Top fixed bar
       ------------------------- */
    .top-bar{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 28px;
      gap:12px;
      z-index:1000;
      backdrop-filter: blur(6px) saturate(.9);
      background: linear-gradient(180deg, rgba(139,69,19,0.95), rgba(210,105,30,0.8));
      border-bottom:2px solid rgba(184,134,11,0.6);
      box-shadow: 0 6px 20px rgba(139,69,19,0.4);
    }

    .bar-left, .bar-right { display:none; }
    .bar-center { display:flex; }
    
    /* Desktop top row layout */
    .top-row { 
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      justify-content: space-between;
    }

    /* Return button */
    .return-btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 16px;
      border-radius:8px;
      cursor:pointer;
      text-decoration:none;
      font-weight:700;
      background:rgba(255,255,255,0.1);
      color:#ffffff;
      border:2px solid rgba(255,255,255,0.15);
      transition: background .22s ease, color .22s ease, transform .12s ease, border-color .22s ease;
    }
    .return-btn:hover,
    .return-btn:focus{
      background:#B8860B; /* dark goldenrod */
      color:#fff;
      border-color:#FFD700; /* gold */
      outline:none;
      transform:translateY(-1px);
      box-shadow:0 8px 20px rgba(184,134,11,0.35);
    }

    /* Title */
    .title {
      font-size:20px;
      letter-spacing:2px;
      font-weight:800;
      text-align:center;
      color:#FFD700; /* gold */
      text-transform:uppercase;
      padding:6px 12px;
      position:relative;
      text-shadow: 2px 2px 4px rgba(139,69,19,0.7);
    }
    .title::after{
      content:"";
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:-8px;
      width:60px;
      height:6px;
      border-radius:6px;
      background:linear-gradient(90deg,#FFD700,#B8860B);
      filter:drop-shadow(0 6px 16px rgba(184,134,11,0.4));
      opacity:.85;
    }

    /* Info (?) button */
    .info-btn{
      width:44px;height:44px;border-radius:10px;border:none;
      background:transparent;cursor:pointer;font-weight:700;
      display:inline-grid;place-items:center;font-size:18px;
      color:#FFD700; /* gold */
      transition:transform .12s ease, background .12s ease;
    }
    .info-btn:hover{ transform:translateY(-1px); background: rgba(184,134,11,0.2); }

    /* -------------------------
       Main layout (Widescreen >=800px)
       ------------------------- */
    .page-inner{
      max-width:1200px;
      margin: 96px auto 80px; /* leave room for fixed bar */
      padding: 28px;
    }

    .suns-row{
      display:flex;
      gap:28px;
      align-items:flex-start;
      justify-content:space-between;
    }

    /* Moon capsule (default) and expanded panel */
    .sun {
      flex:1 1 0;
      min-width:260px;
      max-width:360px;
      display:flex;
      flex-direction:column;
      align-items:center;
      transition: transform .45s cubic-bezier(.2,.9,.28,1), opacity .35s ease;
      will-change: transform, opacity;
      position:relative;
    }

    /* The shooting star webp images - maintain aspect ratio 1698:1218 */
    .moon .orb {
      width:300px;
      height:215px; /* maintain aspect ratio 1698:1218 */
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: transform .35s ease, box-shadow .35s ease, filter .35s ease;
      animation: shootingStar 3s ease-in-out infinite;
      user-select:none;
      border-radius: 16px;
      overflow: hidden;
      border: 3px solid #B8860B;
      box-shadow: 
        0 0 20px rgba(255,215,0,0.3),
        0 8px 25px rgba(139,69,19,0.4),
        inset 0 0 20px rgba(184,134,11,0.1);
    }
    
    .moon .orb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 13px;
    }
    
    .orb:hover{ 
      transform: scale(1.06); 
      box-shadow: 
        0 0 30px rgba(255,215,0,0.5),
        0 12px 35px rgba(139,69,19,0.5),
        inset 0 0 25px rgba(184,134,11,0.2);
      filter:brightness(1.1) saturate(1.1) contrast(1.05);
      border-color: #FFD700;
    }

    @keyframes shootingStar {
      0%{ 
        transform: translateY(0) rotate(0deg);
        filter: drop-shadow(0 0 5px rgba(255,215,0,0.3));
      }
      25% {
        transform: translateY(-3px) rotate(1deg);
        filter: drop-shadow(0 0 15px rgba(255,215,0,0.6));
      }
      50%{ 
        transform: translateY(-12px) rotate(0deg);
        filter: drop-shadow(0 0 25px rgba(255,215,0,0.8));
      }
      75% {
        transform: translateY(-3px) rotate(-1deg);
        filter: drop-shadow(0 0 15px rgba(255,215,0,0.6));
      }
      100%{ 
        transform: translateY(0) rotate(0deg);
        filter: drop-shadow(0 0 5px rgba(255,215,0,0.3));
      }
    }

    /* Shooting star label below */
    .moon .label {
      margin-top:18px;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:1px;
      color:#2F1B14;
      font-size:14px;
      text-shadow: 1px 1px 2px rgba(255,215,0,0.3);
      background: rgba(222,184,135,0.3);
      padding: 4px 12px;
      border-radius: 20px;
      border: 1px solid rgba(184,134,11,0.4);
    }

    /* Expanded panel */
    .panel {
      position: relative;
      width: 100%;
      margin-top: 18px;
      border-radius: 14px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(245,222,179,0.95), rgba(222,184,135,0.98));
      box-shadow: 0 18px 40px rgba(139,69,19,0.4);
      transform-origin: top center;
      opacity: 0;
      max-height: 0;
      padding: 0 22px;
      border: 2px solid rgba(184,134,11,0.4);
      transition:
        opacity .4s ease,
        max-height .75s ease;   /* slowed for smoother expansion */
    }

    /* when expanded */
    .sun.expanded .panel {
      opacity: 1;
      max-height: 2000px;        /* HIGH VALUE to allow full text height */
      padding: 18px 22px 30px;
    }

    /* when expanded */
    .sun.expanded{
      transform:translateY(-2px) scale(1.02);
      z-index:30;
    }

    /* Close button (top-left inside panel) */
    .close-x{
      position:absolute;
      left:14px;
      top:14px;
      width:36px;height:36px;border-radius:8px;
      display:inline-grid;place-items:center;
      cursor:pointer;border:none;background:transparent;font-weight:700;
      color:#8B4513;
      transition: transform .12s ease;
    }
    .close-x:hover{ transform:translateY(-2px); background: rgba(184,134,11,0.2); }

    /* Panel title */
    .panel .panel-title{
      text-transform:uppercase;
      font-weight:900;
      letter-spacing:1.5px;
      font-size:18px;
      margin-left:58px; /* leave space for close button */
      margin-bottom:12px;
      color:#8B4513;
      text-shadow: 1px 1px 2px rgba(255,215,0,0.2);
    }

    /* Image with faded/dissolved top border */
    .panel .fade-image{
      width:100%;
      height:220px;
      border-radius:10px;
      object-fit:cover;
      display:block;
        mask-image: radial-gradient(circle, 
            rgba(0,0,0,1) 40%, 
            rgba(0,0,0,0.5) 70%, 
            rgba(0,0,0,0) 100%
        );
        -webkit-mask-image: radial-gradient(circle, 
            rgba(0,0,0,1) 40%, 
            rgba(0,0,0,0.5) 70%, 
            rgba(0,0,0,0) 100%
        );
      box-shadow: inset 0 30px 60px rgba(139,69,19,0.3);
      margin-bottom:14px;
      background:linear-gradient(180deg,#F5DEB3,#DEB887);
      border: 1px solid rgba(184,134,11,0.3);
    }

    /* Text area */
    .panel .panel-body {
      font-size:15px;
      line-height:1.6;
      color:#2F1B14;
    }
    .panel .panel-body p{ margin-bottom:12px }
    .panel .panel-body ul{ margin-left:18px; margin-bottom:12px }
    .panel .panel-body li{ margin-bottom:6px }

    /* When another orb is expanded, all others fully fade & slide down */
    .sun.dimmed{
      opacity: 0;                 /* fully invisible */
      transform: translateY(60px) scale(.94);
      pointer-events: none;
      filter: blur(4px);          /* optional atmospheric blur */
      transition:
        opacity .45s ease,
        transform .55s cubic-bezier(.2,.9,.28,1),
        filter .35s ease;
    }
    /* -------------------------
       Tablet and mobile screens
       ------------------------- */
    @media (max-width: 800px) {
      .page-inner{ margin:120px 18px 48px }
      .suns-row{flex-direction:column; gap:18px}
      .sun{max-width:100%}
      .moon .orb{ width:200px; height:144px; } /* maintain aspect ratio on mobile */
      .panel .fade-image{ height:160px }
      
      /* Mobile top bar layout - stacked layout */
      .top-bar{
        height: auto;
        min-height: 96px;
        padding: 12px 18px;
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }
      
      /* Make top-bar children stack properly on mobile */
      .top-bar > * {
        width: 100%;
      }
      
      /* Desktop layout elements are already hidden */
      
      /* Mobile top row styling */
      .top-row {
        display: flex !important;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 0;
      }
      
      /* Show and center title on mobile */
      .top-bar .bar-center {
        display: flex;
        position: static;
        transform: none;
        width: 100%;
        justify-content: center;
        margin: 0;
        order: 2; /* Put title below the buttons on mobile */
      }
      
      /* Adjust top-row order for mobile */
      .top-bar .top-row {
        order: 1; /* Put buttons on top for mobile */
      }
      
      .title {
        font-size: 18px;
        letter-spacing: 1.5px;
        margin: 0;
      }
      
      /* Return button styling on mobile */
      .top-row .return-btn {
        padding: 8px 12px;
        font-size: 14px;
        margin: 0;
        display: inline-flex !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Info button styling on mobile */
      .top-row .info-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
        margin: 0;
        display: inline-grid !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
    }

    .sun.dimmed .orb{
      filter: brightness(0.7) blur(8px) sepia(0.3);
    }
/*    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between; // keep left/right in place 
      padding: 0 28px;
      gap: 12px;
      z-index: 1000;
      backdrop-filter: blur(6px) saturate(.9);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      border-bottom: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }*/

    /* PERFECT CENTERING FIX */
    .bar-center {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

  </style>
</head>
<body>

  <!-- Top bar -->
  <header class="top-bar" role="banner" aria-label="Top navigation">
    <div class="top-row">
      <a href="../dreamer.html" class="return-btn" title="Return To Dreaming…">← Return To Dreaming…</a>
      <button class="info-btn" id="openInfo" aria-expanded="false" aria-controls="infoPanel" title="More information">?</button>
    </div>

    <div class="bar-center">
      <div class="title" aria-hidden="true">THE WORLD</div>
    </div>
  </header>

  <!-- Supplemental info modal/panel -->
  <div id="infoPanel" role="dialog" aria-modal="true" aria-hidden="true"
       style="position:fixed; right:22px; top:80px; width:360px; max-width:calc(100% - 48px); z-index:1200;
              border-radius:12px; background:linear-gradient(180deg,#F5DEB3,#DEB887); padding:18px; box-shadow:0 20px 60px rgba(139,69,19,0.6); border:2px solid rgba(184,134,11,0.4); display:none;">
    <button id="closeInfo" style="position:absolute; right:10px; top:10px; border:none; background:transparent; cursor:pointer; font-weight:700; color:#8B4513;">✕</button>
    <h3 style="margin-bottom:8px; font-size:16px; text-transform:uppercase; letter-spacing:1px; color:#8B4513;">About The World</h3>
    <p style="font-size:14px; line-height:1.5; color:#2F1B14;">
      This panel holds supplemental context and worldbuilding for "The World".
      Click any image to expand its chapter. When one expands, the others fade and slide down to emphasise the active chapter.
    </p>
  </div>

  <main class="page-inner" id="main" role="main">
    <section class="suns-row" aria-label="Chapters of the world">

      <!-- THE DUSK -->
      <article class="sun moon" id="dusk" data-key="dusk" aria-labelledby="dusk-label">
        <div class="orb" role="button" tabindex="0" aria-pressed="false" aria-label="Open The Dusk">
          <img src="../P986/cards/backs/550_back.webp" alt="The Dusk background image" />
        </div>
        <div class="label" id="dusk-label">Adventure</div>

        <div class="panel" aria-hidden="true">
          <button class="close-x" aria-label="Close The Dusk">✕</button>
          <div class="panel-title">Adventure "A" Cards</div>
          <!-- image: replace src with your own; masked to fade near top -->
          <img class="fade-image" alt="Dusk image" src="..\media\sunset2.webp?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=5f6b4a6c6f79c2b2f9d2c79e2d5d9b0d">
          <div class="panel-body">
            <p><strong>SUNSET</strong>: After concluding the eleventh space, the next player will make a decision.</p>
            <p>PROCEED to...</p>
            <ul>
              <li>DAWN: conclude the current cycle and move to the next cycle.</li>
              <li>Resolve any effects.</li>
              <li>The player whom decided to proceed to DAWN takes their turn immediately after DAWN is concluded.</li>
              <li>NIGHT: begin the NIGHT phase.</li>
              <li>Night effects on map cards must be activated.</li>
              <li>Night effects for players activate immediately or on the beginning of their turn.</li>
              <li>The player whom decided to enter the NIGHT takes their turn immediately.</li>
            </ul>
            <p><em>Notes:</em> The narrator may enhance the difficulty of A/B/C cards at night arbitrarily.</p>
          </div>
        </div>
      </article>

      <!-- THE FULL MOON -->
      <article class="sun moon" id="fullmoon" data-key="fullmoon" aria-labelledby="fullmoon-label">
        <div class="orb" role="button" tabindex="0" aria-pressed="false" aria-label="Open The Full Moon">
          <img src="../P986/cards/backs/560_back.webp" alt="The Moon Rises background image" />
        </div>
        <div class="label" id="fullmoon-label">Bravery</div>

        <div class="panel" aria-hidden="true">
          <button class="close-x" aria-label="Close The Full Moon">✕</button>
          <div class="panel-title">Bravery "B" Cards</div>
          <img class="fade-image" alt="Full moon image" src=..\media\nightmoon.webp?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=6f9b5f6a2b3b1f0c1a3a6f2f8c7e8d9a>
          <div class="panel-body">
            <p><strong>LAYOUT</strong>: Arrange the area with night zones in mind: six spaces are needed for the NIGHT phase, typically nested within the outer ring of the DAY.</p>
            <p>Setup:</p>
            <ul>
              <li>Arrange six spaces for playing Bravery and Challenge cards (B and C cards).</li>
              <li>The first NIGHT card must be a Bravery (B) card.</li>            
              <li>The second NIGHT card must be a Challenge (C) card.</li>            
              <li>Alternate B and C cards until a total of six cards have been played.</li>            
              <li>Upon completing any card at NIGHT, move on to the next player.</li>
              <li>Upon the next player's turn, they may choose to flee the NIGHT and continue to DAWN, or to continue deeper into the NIGHT.</li>
            </ul>
            <p><em>Notes:</em> You may always appeal to the narrator during the night, especially when consulting your NPCs.</p>
          </div>
        </div>
      </article>

      <!-- THE CRESCENT MOON -->
      <article class="sun moon" id="crescent" data-key="crescent" aria-labelledby="crescent-label">
        <div class="orb" role="button" tabindex="0" aria-pressed="false" aria-label="Open The Crescent Moon">
          <img src="../P986/cards/backs/590_back.webp" alt="The Deep Of Night background image" />
        </div>
        <div class="label" id="crescent-label">Challenge</div>

        <div class="panel" aria-hidden="true">
          <button class="close-x" aria-label="Close The Crescent Moon">✕</button>
          <div class="panel-title">Challenge "C" Cards</div>
          <img class="fade-image" alt="Crescent moon image" src="..\media\night.webp?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=8a9e2a2b7b1f2d3f4c5b6c7d8e9a0b1c">
          <div class="panel-body">
            <p><strong>LONGPLAY</strong>: Regardless of entering the night, as the cycle increases at DAWN the night cycle count will also increase. This has various effects on continuing gameplay.</p>
            <p>Examples:</p>
            <ul>
              <li>Chances for creature encounters increase.</li>
              <li>The number and power of enemies increase.</li>
              <li>Negative fateful encounters occur more frequently.</li>
              <li>Weather and seasons become more extreme and foreboding.</li>
              <li>Night survival becomes more challenging.</li>
            </ul>
            <p><em>Note:</em> The narrator may add or negate such effects to their whim.</p>
          </div>
        </div>
      </article>

    </section>
  </main>

  <script>
    // -------------------------
    // Core interactions
    // -------------------------
    (function(){
      const suns = Array.from(document.querySelectorAll('.sun'));
      const infoBtn = document.getElementById('openInfo');
      const infoPanel = document.getElementById('infoPanel');
      const closeInfo = document.getElementById('closeInfo');

      // Helpers
      function closeAllExcept(key){
        suns.forEach(s => {
          const k = s.dataset.key;
          if(k !== key){
            s.classList.remove('expanded');
            s.querySelector('.panel').setAttribute('aria-hidden','true');
            s.querySelector('.orb').setAttribute('aria-pressed','false');
            s.classList.add('dimmed');
          } else {
            s.classList.add('expanded');
            s.classList.remove('dimmed');
            s.querySelector('.panel').setAttribute('aria-hidden','false');
            s.querySelector('.orb').setAttribute('aria-pressed','true');
          }
        });

        // If same key is null => close all
        if(!key){
          suns.forEach(s=>{
            s.classList.remove('expanded','dimmed');
            s.querySelector('.panel').setAttribute('aria-hidden','true');
            s.querySelector('.orb').setAttribute('aria-pressed','false');
          });
        }
      }

      // Toggle logic: open clicked, dim others and slide them down (CSS handles translation via .dimmed)
      suns.forEach(sun => {
        const orb = sun.querySelector('.orb');
        const panel = sun.querySelector('.panel');
        const close = sun.querySelector('.close-x');

        function expand(){
          const isExpanded = sun.classList.contains('expanded');
          if(isExpanded){
            // collapse
            sun.classList.remove('expanded');
            panel.setAttribute('aria-hidden','true');
            orb.setAttribute('aria-pressed','false');
            // restore all
            suns.forEach(other=> other.classList.remove('dimmed'));
          } else {
            // expand this one
            closeAllExcept(sun.dataset.key);
            // scroll into view smoothly (center active)
            setTimeout(()=> {
              sun.scrollIntoView({behavior:'smooth', block:'center'});
            }, 60);
          }
        }

        orb.addEventListener('click', expand);
        orb.addEventListener('keydown', (ev) => {
          if(ev.key === 'Enter' || ev.key === ' '){
            ev.preventDefault();
            expand();
          }
        });

        close.addEventListener('click', (e) => {
          e.stopPropagation();
          sun.classList.remove('expanded');
          panel.setAttribute('aria-hidden','true');
          orb.setAttribute('aria-pressed','false');
          suns.forEach(other=> other.classList.remove('dimmed'));
        });
      });

      // Click outside: if click on background area, close all
      document.addEventListener('click', (e) => {
        const inMain = e.target.closest('.suns-row') || e.target.closest('.panel') || e.target.closest('.orb');
        const inInfo = e.target.closest('#infoPanel') || e.target.closest('#openInfo');
        if(!inMain && !inInfo){
          closeAllExcept(null);
        }
      });

      // Info panel toggle
      infoBtn.addEventListener('click', (e) => {
        const visible = infoPanel.style.display !== 'none';
        if(visible){
          infoPanel.style.display = 'none';
          infoBtn.setAttribute('aria-expanded','false');
          infoPanel.setAttribute('aria-hidden','true');
        } else {
          infoPanel.style.display = 'block';
          infoBtn.setAttribute('aria-expanded','true');
          infoPanel.setAttribute('aria-hidden','false');
        }
      });
      closeInfo.addEventListener('click', ()=> {
        infoPanel.style.display = 'none';
        infoBtn.setAttribute('aria-expanded','false');
        infoPanel.setAttribute('aria-hidden','true');
      });

      // keyboard: ESC closes expanded panels and info panel
      document.addEventListener('keydown', (ev) => {
        if(ev.key === 'Escape'){
          closeAllExcept(null);
          infoPanel.style.display = 'none';
          infoBtn.setAttribute('aria-expanded','false');
          infoPanel.setAttribute('aria-hidden','true');
        }
      });

      // Prevent pointer events for dimmed nodes after transition (cleanup)
      // (Optional) Add small delay to re-enable pointer events after expansion finished.
      // We rely on pointer-events:none applied via .dimmed (see CSS) so no further JS required.

    })();
  </script>
</body>
</html>